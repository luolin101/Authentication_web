{"remainingRequest":"C:\\Users\\86191\\Desktop\\text\\Authentication_web\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!C:\\Users\\86191\\Desktop\\text\\Authentication_web\\src\\components\\page\\Upload.vue?vue&type=style&index=0&id=5e57d17e&lang=css","dependencies":[{"path":"C:\\Users\\86191\\Desktop\\text\\Authentication_web\\src\\components\\page\\Upload.vue","mtime":1611590737000},{"path":"C:\\Users\\86191\\Desktop\\text\\Authentication_web\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86191\\Desktop\\text\\Authentication_web\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\86191\\Desktop\\text\\Authentication_web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\86191\\Desktop\\text\\Authentication_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\86191\\Desktop\\text\\Authentication_web\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgLnVwbG9hZGVyLXVpIHsKICAgIHBhZGRpbmc6IDE1cHg7CiAgICBtYXJnaW46IDQwcHggYXV0byAwOwogICAgZm9udC1zaXplOiAxMnB4OwogICAgZm9udC1mYW1pbHk6IE1pY3Jvc29mdCBZYUhlaTsKICAgIGJveC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMCwgMCwgLjQpOwogIH0KICAudXBsb2FkZXItdWkgLnVwbG9hZGVyLWJ0biB7CiAgICBtYXJnaW4tcmlnaHQ6IDRweDsKICAgIGZvbnQtc2l6ZTogMTJweDsKICAgIGJvcmRlci1yYWRpdXM6IDNweDsKICAgIGNvbG9yOiAjRkZGOwogICAgYmFja2dyb3VuZC1jb2xvcjogIzQwOUVGRjsKICAgIGJvcmRlci1jb2xvcjogIzQwOUVGRjsKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIGxpbmUtaGVpZ2h0OiAxOwogICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICB9CiAgLnVwbG9hZGVyLXVpIC51cGxvYWRlci1saXN0IHsKICAgIG1heC1oZWlnaHQ6IDQ0MHB4OwogICAgb3ZlcmZsb3c6IGF1dG87CiAgICBvdmVyZmxvdy14OiBoaWRkZW47CiAgICBvdmVyZmxvdy15OiBhdXRvOwogIH0K"},{"version":3,"sources":["C:\\Users\\86191\\Desktop\\text\\Authentication_web\\src\\components\\page\\Upload.vue"],"names":[],"mappings":"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","file":"C:/Users/86191/Desktop/text/Authentication_web/src/components/page/Upload.vue","sourceRoot":"","sourcesContent":["<template>\n    <!-- 上传器 -->\n    <uploader\n        ref=\"uploader\"\n        :options=\"options\"\n        :autoStart=false\n        :file-status-text=\"fileStatusText\"\n        @file-added=\"onFileAdded\"\n        @file-success=\"onFileSuccess\"\n        @file-progress=\"onFileProgress\"\n        @file-error=\"onFileError\"\n        class=\"uploader-ui\"> \n        <uploader-unsupport></uploader-unsupport>\n        <uploader-drop>\n            <div>\n                <uploader-btn id=\"global-uploader-btn\" :attrs=\"attrs\" ref=\"uploadBtn\">选择文件<i class=\"el-icon-upload el-icon--right\"></i></uploader-btn>\n            </div>\n        </uploader-drop>\n        <uploader-list></uploader-list>\n    </uploader>\n</template>\n\n<script>\n    import {ACCEPT_CONFIG} from '../common/config';\n    import SparkMD5 from 'spark-md5';\n    import {mergeFile} from \"@/api/modules/uploadFile\";\n\n    export default {\n        data () {\n            return {\n                options: {\n                    //目标上传 URL，默认POST\n                    target: process.env.VUE_APP_BASE_API+\"/uploader/chunk\",\n                    //分块大小(单位：字节)\n                    chunkSize: '2048000',\n                    //上传文件时文件内容的参数名，对应chunk里的Multipart对象名，默认对象名为file\n                    fileParameterName: 'upfile',\n                    //失败后最多自动重试上传次数\n                    maxChunkRetries: 3,\n                    //是否开启服务器分片校验，对应GET类型同名的target URL\n                    testChunks: true,   \n                    /* \n                    服务器分片校验函数，判断秒传及断点续传,传入的参数是Uploader.Chunk实例以及请求响应信息\n                    reponse码是successStatuses码时，才会进入该方法\n                    reponse码如果返回的是permanentErrors 中的状态码，不会进入该方法，直接进入onFileError函数 ，并显示上传失败\n                    reponse码是其他状态码，不会进入该方法，正常走标准上传\n                    checkChunkUploadedByResponse函数直接return true的话，不再调用上传接口\n                    */\n                    checkChunkUploadedByResponse: function (chunk, response_msg) {\n                        let objMessage = JSON.parse(response_msg);\n                        if (objMessage.skipUpload) {\n                            return true;\n                        }\n                        return (objMessage.uploadedChunks || []).indexOf(chunk.offset + 1) >= 0;\n                    }      \n                },\n                attrs: {\n                    accept: ACCEPT_CONFIG.getAll()\n                },\n                fileStatusText: {\n                        success: '上传成功',\n                        error: '上传失败',\n                        uploading: '上传中',\n                        paused: '暂停',\n                        waiting: '等待上传'\n                },\n            }\n        },\n        methods: {\n            onFileAdded(file) {\n                this.computeMD5(file);\n            },\n            /*\n            第一个参数 rootFile 就是成功上传的文件所属的根 Uploader.File 对象，它应该包含或者等于成功上传文件；\n            第二个参数 file 就是当前成功的 Uploader.File 对象本身；\n            第三个参数就是 message 就是服务端响应内容，永远都是字符串；\n            第四个参数 chunk 就是 Uploader.Chunk 实例，它就是该文件的最后一个块实例，如果你想得到请求响应码的话，chunk.xhr.status就是\n            */\n            onFileSuccess(rootFile, file, response, chunk) {\n                //refProjectId为预留字段，可关联附件所属目标，例如所属档案，所属工程等\n                file.refProjectId = \"123456789\";\n                mergeFile(file).then( responseData=> {\n                    if(responseData.data.code === 415){\n                        console.log(\"合并操作未成功，结果码：\"+responseData.data.code);\n                    }\n                }).catch(function (error){\n                    console.log(\"合并后捕获的未知异常：\"+error);\n                });\n            },\n            onFileError(rootFile, file, response, chunk) {\n                console.log('上传完成后异常信息：'+response);\n            },\n\n            /**\n             * 计算md5，实现断点续传及秒传\n             * @param file\n             */\n            computeMD5(file) {\n                file.pause();\n\n                //单个文件的大小限制2G\n                let fileSizeLimit = 2 * 1024 * 1024 * 1024;\n                console.log(\"文件大小：\"+file.size);\n                console.log(\"限制大小：\"+fileSizeLimit);\n                if(file.size > fileSizeLimit){\n                    this.$message({\n                        showClose: true,\n                        message: '文件大小不能超过2G'\n                    });\n                    file.cancel();\n                }\n\n                let fileReader = new FileReader();\n                let time = new Date().getTime();\n                let blobSlice = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice;\n                let currentChunk = 0;\n                const chunkSize = 10 * 1024 * 1000;\n                let chunks = Math.ceil(file.size / chunkSize);\n                let spark = new SparkMD5.ArrayBuffer();\n                //由于计算整个文件的Md5太慢，因此采用只计算第1块文件的md5的方式\n                let chunkNumberMD5 = 1;\n\n                loadNext();\n\n                fileReader.onload = (e => {\n                    spark.append(e.target.result);\n\n                    if (currentChunk < chunkNumberMD5) {\n                        loadNext();\n                    } else {\n                        let md5 = spark.end();\n                        file.uniqueIdentifier = md5;\n                        file.resume();\n                        console.log(`MD5计算完毕：${file.name} \\nMD5：${md5} \\n分片：${chunks} 大小:${file.size} 用时：${new Date().getTime() - time} ms`);\n                    }\n                });\n\n                fileReader.onerror = function () {\n                    this.error(`文件${file.name}读取出错，请检查该文件`)\n                    file.cancel();\n                };\n\n                function loadNext() {\n                    let start = currentChunk * chunkSize;\n                    let end = ((start + chunkSize) >= file.size) ? file.size : start + chunkSize;\n\n                    fileReader.readAsArrayBuffer(blobSlice.call(file.file, start, end));\n                    currentChunk++;\n                    console.log(\"计算第\"+currentChunk+\"块\");\n                }\n            },\n            close() {\n                this.uploader.cancel();\n            },\n            error(msg) {\n                this.$notify({\n                    title: '错误',\n                    message: msg,\n                    type: 'error',\n                    duration: 2000\n                })\n            }\n        }\n    }\n</script>\n\n<style>\n  .uploader-ui {\n    padding: 15px;\n    margin: 40px auto 0;\n    font-size: 12px;\n    font-family: Microsoft YaHei;\n    box-shadow: 0 0 10px rgba(0, 0, 0, .4);\n  }\n  .uploader-ui .uploader-btn {\n    margin-right: 4px;\n    font-size: 12px;\n    border-radius: 3px;\n    color: #FFF;\n    background-color: #409EFF;\n    border-color: #409EFF;\n    display: inline-block;\n    line-height: 1;\n    white-space: nowrap;\n  }\n  .uploader-ui .uploader-list {\n    max-height: 440px;\n    overflow: auto;\n    overflow-x: hidden;\n    overflow-y: auto;\n  }\n</style>"]}]}