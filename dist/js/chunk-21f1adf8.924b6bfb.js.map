{"version":3,"sources":["webpack:///./src/views/QR.vue","webpack:///./src/views/QR.vue?5d72","webpack:///./src/views/QR.vue?51cb"],"names":["class","to","src","imgURL","alt","state","getToken","userAvatar","userName","tip","name","data","count","authToken","userId","tokenApi","tokenImgApi","tokenInfoApi","userInfoApi","created","this","methods","console","log","clearInterval","timeCount","request","post","then","res","setInterval","getTokenInfo","catch","error","response","auth","authState","$message","message","type","getUserInfo","$ajax","method","url","qs","stringify","__exports__","render"],"mappings":"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","file":"js/chunk-21f1adf8.924b6bfb.js","sourcesContent":["<template>\n  <!-- 扫码登录 -->\n  <div class=\"login_box\">\n    <router-link to=\"/input\">\n      <div class=\"login_close\"></div>\n    </router-link>\n    <div class=\"qrcode\">\n      <img class=\"img\" :src=\"imgURL\" alt=\"登录码\" v-show=\"state === 1||state === 3\"/>\n      <div class=\"empty\" v-show=\"state === 0\"></div>\n      <div class=\"refresh\" v-show=\"state === 3\">\n        <i class=\"refresh_mask\"></i>\n        <i class=\"refresh_icon\" @click=\"getToken\"></i>\n      </div>\n      <div class=\"result\" v-show=\"state === 2\">\n        <img class=\"u_avatar\" :src=\"userAvatar\" alt=\"用户头像\"/>\n        <p class=\"u_name\">{{userName}}</p>\n      </div>\n      <div>\n        <p class=\"sub_title\">{{tip}}</p>\n        <p class=\"sub_desc\">扫码登录，更易、更快、更安全</p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n\nimport request from \"@/utils/request\";\n\nexport default {\n  name: 'Auth',\n  data () {\n    return {\n      state: 0, // 场景：0无登录码，1有登陆码，2正在登录，3登录码过期\n      count: 30, // 登录码有效倒计时（S）\n      tip: '正在获取登录码，请稍等', // 提示\n      imgURL: '', // 登录码路径\n      authToken: '', // 验证口令\n      userId: '', // 扫码登录的用户ID\n      userAvatar: '', // 扫码登录的用户头像\n      userName: '', // 扫码登录的用户名\n      tokenApi: '/auth/token', // 获取口令\n      tokenImgApi: '/auth/img/', // 获取口令对应的登录码\n      tokenInfoApi: '/auth/info/', // 获取口令信息\n      userInfoApi: '/login/getUser' // 获取用户信息\n    }\n  },\n  created () {\n    this.getToken()\n  },\n  methods: {\n    getToken () {\n      console.log('开始获取')\n      // 所有参数重置\n      this.state = 0 // 场景为无二维码\n      this.tip = '正在获取登录码，请稍等'\n      this.count = 30\n      clearInterval(this.timeCount)\n      // 开始获取新的token\n      request.post(this.tokenApi).then((res) => {\n        // 保存token，改变场景，显示登录码，开始轮询\n        this.authToken = res.data\n        console.log(this.authToken,\"token\")\n        this.state = 1 // 场景为有登录码\n        this.tip = '请使用手机口令扫码登录'\n        this.imgURL = 'http://localhost:9090'+this.tokenImgApi + res.data // 拼装获得登录码链接\n        console.log(this.imgURL)\n        this.timeCount = setInterval(this.getTokenInfo, 1000) // 开启每隔1S的轮询，向服务器请求口令信息\n      }).catch((error) => {\n        console.log(error)\n        this.getToken()\n      })\n    },\n    getTokenInfo () {\n      // 登录码有效时间减少\n      this.count--\n      // 登录码到期，改变场景\n      if (this.count === 0) {\n        this.state = 3 // 场景为登录码过期\n        this.tip = '二维码已过期，请刷新'\n      }\n      // 防止计数溢出\n      if (this.count < -1000) {\n        this.count = -1\n      }\n      // 轮询查询token状态\n      request.post(this.tokenInfoApi + this.authToken).then((response) => {\n        let auth = response.data\n        // token状态为登录成功\n        if (auth.authState === 1) {\n          this.$message({\n            message: '登录成功！',\n            type: 'success'\n          })\n          clearInterval(this.timeCount) // 关闭轮询，溜了\n          // token状态为正在登陆，改变场景，请求扫码用户信息\n        } else if (auth.authState === 2) {\n          this.userId = auth.userId\n          this.getUserInfo()\n          this.state = 2\n          this.tip = '扫码成功，请在手机上确认'\n          // token状态为过期（服务器），改变场景\n        } else if (auth.authState === 3) {\n          this.state = 3\n          this.tip = '二维码已过期，请刷新'\n        }\n      }).catch((error) => {\n        console.log(error)\n      })\n    },\n    getUserInfo () {\n      this.$ajax({\n        method: 'post',\n        url: this.userInfoApi,\n        data: this.qs.stringify({\n          userId: this.userId\n        })\n      }).then((response) => {\n        // 获取用户信息，并进行显示\n        this.userName = response.data.data.userName\n        this.userAvatar = response.data.data.userAvatar\n        console.log(response.data.data)\n      }).catch((error) => {\n        console.log(error)\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n  /*登录框*/\n  .login_box {\n    z-index: 99;\n    position: absolute;\n    width: 380px;\n    height: 540px;\n    top: 50%;\n    left: 50%;\n    margin-left: -190px;\n    margin-top: -270px;\n    border-radius: 6px;\n    background-color: #fff;\n    box-shadow: 0 2px 10px #999;\n  }\n\n  .login_close {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 64px;\n    height: 64px;\n    background: url(../assets/img/pcinput.png) no-repeat right top;\n    background-size: 100% 100%;\n    border-top-right-radius: 5px;\n    cursor: pointer;\n    z-index: 99;\n  }\n  /*二维码*/\n  .qrcode {\n    position: relative;\n    text-align: center;\n  }\n\n  /* 二维码获取 */\n  .qrcode .img {\n    display: block;\n    width: 240px;\n    height: 240px;\n    margin: 70px auto 25px;\n  }\n\n  .qrcode .sub_title {\n    text-align: center;\n    font-size: 19px;\n    color: #353535;\n    margin-bottom: 23px;\n  }\n\n  .qrcode .sub_desc {\n    text-align: center;\n    color: #a3a3a3;\n    font-size: 14px;\n    padding: 0 40px;\n    line-height: 1.8;\n  }\n\n  /* 二维码为空 */\n  .qrcode .empty {\n    display: block;\n    width: 240px;\n    height: 240px;\n    margin: 70px auto 25px;\n    background: #d7e8fc;\n  }\n\n  /* 二维码刷新 */\n  .qrcode .refresh {\n    display: block;\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 240px;\n  }\n\n  .qrcode .refresh .refresh_mask {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -120px;\n    margin-top: -120px;\n    width: 240px;\n    height: 240px;\n    background: #ffffffe0;\n  }\n\n  .qrcode .refresh .refresh_icon {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -48px;\n    margin-top: -48px;\n    height: 96px;\n    width: 96px;\n    cursor: pointer;\n    background: url(../assets/img/refresh.png) no-repeat;\n  }\n\n  .qrcode .refresh .refresh_icon:hover {\n    animation: refresh 1s linear infinite;\n  }\n\n  @keyframes refresh {\n    0% {\n      transform: rotate(0deg);\n    }\n\n    100% {\n      transform: rotate(360deg);\n    }\n  }\n\n  /* 二维码结果 */\n  .qrcode .result {\n    display: block;\n    width: 240px;\n    height: 240px;\n    margin: 70px auto 25px;\n  }\n\n  .qrcode .result .u_avatar {\n    height: 150px;\n    width: 150px;\n    margin-top: 15px;\n    border-radius: 5px;\n    box-shadow: 0 2px 10px #999;\n    -moz-box-shadow: #999 0 2px 10px;\n    -webkit-box-shadow: #999 0 2px 10px;\n  }\n\n  .qrcode .result .u_name {\n    text-align: center;\n    font-size: 19px;\n    color: #353535;\n    margin-top: 20px;\n  }\n</style>\n","import { render } from \"./QR.vue?vue&type=template&id=2da623b6&scoped=true\"\nimport script from \"./QR.vue?vue&type=script&lang=js\"\nexport * from \"./QR.vue?vue&type=script&lang=js\"\n\nimport \"./QR.vue?vue&type=style&index=0&id=2da623b6&scoped=true&lang=css\"\n\nimport exportComponent from \"C:\\\\Users\\\\86191\\\\Desktop\\\\text\\\\Authentication_web\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2da623b6\"]])\n\nexport default __exports__","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./QR.vue?vue&type=style&index=0&id=2da623b6&scoped=true&lang=css\""],"sourceRoot":""}